const jq_throttle=function(e,t,n,s){var a,i=0;return"boolean"!=typeof t&&(s=n,n=t,t=void 0),function(){return new Promise(((o,r)=>{var l=this,h=+new Date-i,c=arguments;function m(){return i=+new Date,n.apply(l,c)}return s&&!a?o(m()):(a&&clearTimeout(a),void 0===s&&h>e?o(m()):void(!0!==t&&(a=setTimeout(s?function(){a=void 0}:()=>{o(m())},void 0===s?e-h:e))))}))}},debounce=function(e,t,n){return console.assert(null!==n,"Callback is null"),jq_throttle(e,n,!1!==t)};function getUrlFromFileId(e,t){let n=e.IomInnovator.newItem("File","get");return n.setAttribute("id",t),n=n.apply(),e.vault.vault.makeFileDownloadUrl(e.getFileURLEx(n.node))}const state={itemTypeName:"ItemType",searchOverlayContent:null,reset:function(){this.itemTypeName="ItemType",this.defaultImage="../images/ItemType.svg",this.searchOverlayContent.elements.title.textContent="ItemTypes",this.searchOverlayContent.elements.input.value="",this.searchOverlayContent.elements.input.placeholder="Search ItemType",this.searchOverlayContent.handlesearchItemsData([])},setItemTypeName:function(e,t,n){this.itemTypeName=e,this.defaultImage=n||"../images/DefaultItemType.svg",this.searchOverlayContent.elements.title.textContent=t,this.searchOverlayContent.elements.input.value="",this.searchOverlayContent.elements.input.placeholder=`Search ${t}`,this.searchOverlayContent.handlesearchItemsData([])},defaultImage:null};class SearchItem{constructor(e,t,n,s,a){this.elements={},this.data=a,this.index=s,this.createDom(n,e,t,s)}createDom(e,t,n,s){this.remove(),this.elements.root=document.createElement("div"),this.elements.root.classList.add("search-item");const a=document.createElement("div");a.classList.add("flex-row","jcc","aic"),this.elements.image=document.createElement("img"),this.elements.image.src=e||`https://picsum.photos/seed/${Date.now()}/50/50`;const i=document.createElement("div");i.classList.add("flex-col"),this.elements.name=document.createElement("span"),this.elements.name.textContent=t,this.elements.description=document.createElement("span"),this.elements.description.classList.add("fw-normal"),this.elements.description.textContent=n,i.appendChild(this.elements.name),i.appendChild(this.elements.description),a.appendChild(this.elements.image),a.appendChild(i),this.elements.index=document.createElement("div"),this.elements.index.textContent=s,this.elements.root.appendChild(a),this.elements.root.appendChild(this.elements.index)}remove(){this.elements.root&&this.elements.root.remove(),this.elements={}}getRoot(){if(!this.elements.root)throw new Error("Call to get root but root doesn't exist");return this.elements.root}}class SearchResults{constructor(e,t){console.assert(e instanceof Array,"searchItems be an array"),this.searchOverlayContent=t,this.elements={},this.searchItems=[],this.setSearchResults(e),this.associatedShortcuts={keydown:[]}}setSearchResults(e){this.remove(),this.elements.root=document.createElement("div"),this.elements.root.classList.add("searchResults"),e.forEach(((e,t)=>{this.searchItems[t]=new SearchItem(e.name,e.description,e.image,t+1,e),this.elements.root.appendChild(this.searchItems[t].getRoot())})),this.setKeyboardShortcuts(!0)}remove(){this.setKeyboardShortcuts(!1),this.elements.root&&this.elements.root.remove(),this.elements={},this.searchItems=[]}setKeyboardShortcuts(e){if(e)this.searchItems.forEach((e=>{const t=t=>{t.keyCode===48+e.index&&t.ctrlKey&&(t.preventDefault(),this.searchOverlayContent.elements.input.value="",this.searchOverlayContent.deactivate(),aras.uiShowItem(e.data.itemTypeName,e.data.item.getAttribute("id")))},n="ItemType"===e.data.itemTypeName?t=>{t.keyCode===48+e.index&&t.altKey&&(t.preventDefault(),this.searchOverlayContent.elements.input.value="",console.log(e.data.item),state.setItemTypeName(e.data.item.getProperty("name"),e.data.item.getProperty("label_plural")||e.data.item.getProperty("keyed_name"),e.elements.image.src))}:null;this.associatedShortcuts.keydown.push(t),document.addEventListener("keydown",t),n&&(this.associatedShortcuts.keydown.push(n),document.addEventListener("keydown",n))}));else for(const e in this.associatedShortcuts)this.associatedShortcuts[e].forEach((t=>{document.removeEventListener(e,t)}))}getSearchItem(e){return console.assert(e<this.searchItems.length,"Requesting search item out of bounds"),this.searchItems[e]}getRoot(){if(!this.elements.root)throw new Error("Call to get root but root doesn't exist");return this.elements.root}}class SearchOverlayContent{constructor(e,t,n){this.elements={},this.events={input:[],keydown:[]},this.searchOverlay=n,this.createDom(e,t),n.appendChild(this.getRoot()),this.applyKeyEvents(),this.isActive=!1,this.cache={images:{}},state.searchOverlayContent=this,state.reset()}createDom(e,t){this.remove(),this.elements.root=document.createElement("div"),this.elements.root.classList.add("search-overlay-content"),this.elements.title=document.createElement("h2"),this.elements.title.classList.add("m-05"),this.elements.title.textContent=e,this.elements.input=document.createElement("input"),this.elements.input.classList.add("search-input"),this.elements.input.type="text",this.elements.input.placeholder=t,this.elements.input.spellCheck=!1,this.elements.searchResults=new SearchResults([],this),this.elements.root.appendChild(this.elements.title),this.elements.root.appendChild(this.elements.input),this.elements.root.appendChild(this.elements.searchResults.getRoot())}applyKeyEvents(){this.events.keydown.push({handler:e=>{if("Escape"===e.key){if(""!==this.elements.input.value)return void(this.elements.input.value="");if("ItemType"!==state.itemTypeName)return void state.reset();this.searchOverlay.style.display="none",this.deactivate()}},originalHandler:e=>{}})}remove(){this.elements.root&&this.elements.root.remove(),this.elements={}}on(e,t,...n){this.events[e]||console.assert(`Event ${e} is not supported`),this.events[e].push({handler:async e=>{await t(e,...n)},originalHandler:t})}off(e,t){this.events[e]||console.assert(`Event ${e} is not supported`),this.events[e]=this.events[e].filter((e=>e.originalHandler!==t))}handlesearchItemsData(e){e.forEach((e=>{e.imageFileId&&!this.cache.images[e.imageFileId]&&(this.cache.images[e.imageFileId]=e.image)})),this.elements.searchResults.setSearchResults(e),this.elements.root.appendChild(this.elements.searchResults.getRoot())}activate(){console.assert(null!==this.elements.root,"Root is null when content is activated"),this.searchOverlay.style.display="block",this.elements.input.focus();for(const e of this.events.input)this.elements.input.addEventListener("input",e.handler);for(const e of this.events.keydown)document.addEventListener("keydown",e.handler);this.isActive=!0}deactivate(){this.searchOverlay.style.display="none";for(const e of this.events.input)this.elements.input.removeEventListener("input",e);for(const e of this.events.keydown)document.removeEventListener("keydown",e);state.reset(),this.isActive=!1}getRoot(){if(!this.elements.root)throw new Error("Call to get root but root doesn't exist");return this.elements.root}}const fetch=async(e,t)=>{if(""===e.target.value.trim())return void t.handlesearchItemsData([]);let n;n="*"===e.target.value.trim?"":"%"+e.target.value.trim().replaceAll(/\s+/g,"%")+"%";const s=await getItems(state.itemTypeName,n,e.target.value.trim(),9,state.defaultImage,t.cache);t.handlesearchItemsData(s)},getItems=debounce(80,!1,((e,t,n,s,a,i)=>{console.log(n);const o=aras.IomInnovator.applyAML(`\n    <AML>\n        <Item type="${e}" action="get" maxRecords="18" select="id,name,keyed_name,open_icon,label_plural">\n            <OR>\n                ${["name","keyed_name","id"].map((e=>`<${e} condition="like">${t}</${e}>`)).join("\n")}\n            </OR>\n        </Item>\n    </AML>\n    `),r=[];for(let t=0;t<o.getItemCount();t++){const n=o.getItemByIndex(t);let s=null,l=null;n.getProperty("open_icon")&&"1"!==n.getPropertyAttribute("open_icon","is_null")&&(n.getProperty("open_icon").includes("vault:")?(l=n.getProperty("open_icon").split("=")[1],s=i.images[l]||getUrlFromFileId(aras,l)):s=n.getProperty("open_icon")),s||(s=a),r.push({image:s,name:n.getProperty("keyed_name"),description:n.getAttribute("id"),item:n,itemTypeName:e,imageFileId:l})}return r.sort(((e,t)=>0===n.length?0:e.name.toLowerCase().startsWith(n[0].toLowerCase())&&!t.name.toLowerCase().startsWith(n.toLowerCase())?-1:0)),r.slice(0,s)})),searchOverlay=document.createElement("div");searchOverlay.classList.add("overlay");const searchOverlayContent=new SearchOverlayContent("Search ItemTypes","ItemTypes",searchOverlay),handleshortcut=e=>{if(75===e.keyCode&&e.ctrlKey){if(e.preventDefault(),searchOverlayContent.isActive)return;searchOverlayContent.activate()}},listenShortcut=async()=>{document.addEventListener("keydown",handleshortcut)},attachCss=()=>{const e=document.createElement("style");e.innerHTML="body {\n        font-family: Arial, sans-serif;\n        margin: 0;\n        padding: 0;\n    }\n    \n    header {\n        background-color: #333;\n        color: #fff;\n        padding: 10px 20px;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n    }\n    \n    button {\n        background-color: #007bff;\n        color: #fff;\n        border: none;\n        padding: 8px 16px;\n        cursor: pointer;\n    }\n    \n    .overlay {\n        display: none;\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background-color: rgba(0, 0, 0, 0.5);\n        z-index: 1000;\n    }\n    \n    .search-overlay-content {\n        position: absolute;\n        top: 10vh;\n        left: 50%;\n        min-width: 60vw;\n        transform: translateX(-50%);\n        background-color: #fff;\n        padding: 20px;\n        border-radius: 5px;\n        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);\n    }\n    \n    .search-input {\n        width: 90%;\n        margin: auto;\n        display: block;\n        padding: 10px 20px;\n        font-family: sans-serif;\n        font-size: 1.3rem;\n        outline: none;\n    \n    }\n    \n    .searchResults {\n        margin-top: 10px;\n    }\n    \n    .search-item {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        font-weight: bold;\n        font-size: 1.2rem;\n        padding: 5px 15px 5px 5px;\n        /* margin-bottom: 5px; */\n        cursor: pointer;\n        border-radius: 5px;\n    }\n    .search-item:hover {\n        background-color: rgba(0, 0, 0, 0.08);\n    }\n    \n    .search-item img {\n        width: 50px;\n        height: 50px;\n        margin-right: 10px;\n    }\n    \n    .flex-row {\n        display: flex;\n        flex-direction: row;\n    }\n    .flex-col {\n        display: flex;\n        flex-direction: column;\n    }\n    .jcc {\n        justify-content: center;\n    }\n    .aic {\n        align-items: center;\n    }\n    \n    .m-05 {\n        margin: .5rem;\n    }\n    \n    /* Font weights */\n    .fw-normal {\n        font-weight: normal;\n    }",document.head.appendChild(e)},start=()=>{searchOverlayContent.on("input",fetch,searchOverlayContent),document.body.appendChild(searchOverlay),attachCss(),listenShortcut()};start();
